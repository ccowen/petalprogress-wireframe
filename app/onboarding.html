<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PetalProgress ‚Äî Get Started</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
:root {
  --bg:        #F8F6F3;
  --surface:   #FDFCFA;
  --warm-1:    #EDE9E3;
  --warm-2:    #D4CEC7;
  --warm-3:    #9C958D;
  --text:      #2C2825;
  --text-soft: #6B6460;
  --text-muted:#A09890;
  --sage:      #8FA68C;
  --blue:      #7B9BAF;
  --coral:     #C45A5A;
  --amber:     #C4887A;
  --ease:      cubic-bezier(0.4,0,0.2,1);
}
html, body { height:100%; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg); color: var(--text);
  display: flex; flex-direction: column;
  font-size: 13px; overflow: hidden;
}

/* ‚îÄ‚îÄ TOP BAR (matches individual dashboard) ‚îÄ‚îÄ */
.topbar {
  height: 54px; flex-shrink: 0;
  background: var(--surface);
  border-bottom: 1px solid var(--warm-1);
  display: flex; align-items: center;
  z-index: 100; padding: 0 24px;
}
.logo-zone {
  display: flex; align-items: center; justify-content: flex-start;
  gap: 8px; flex-shrink: 0; text-decoration: none;
}
.logo { font-family: 'Cormorant Garamond', serif; font-size: 24px; color: var(--text); line-height: 1; }
.logo-name { font-family: 'Cormorant Garamond', serif; font-size: 18px; font-weight: 500; color: var(--text); letter-spacing: 0.01em; white-space: nowrap; }
.nav-tabs { display: flex; gap: 2px; margin-left: 20px; }
.nav-tab {
  padding: 6px 18px; border-radius: 100px; font-size: 12.5px;
  color: var(--text-soft); cursor: pointer; transition: all 0.18s; letter-spacing: 0.01em;
}
.nav-tab:hover { background: var(--warm-1); color: var(--text); }
.nav-tab.active { background: var(--text); color: var(--bg); font-weight: 500; }
.nav-tab.disabled { color: var(--warm-2); cursor: default; pointer-events: none; }
.topbar-right { margin-left: auto; display: flex; align-items: center; gap: 14px; }
.mandala-name-tag { font-family: 'Cormorant Garamond', serif; font-size: 14.5px; font-style: italic; color: var(--text-soft); letter-spacing: 0.03em; }
.avatar { width: 30px; height: 30px; border-radius: 50%; background: var(--warm-1); color: var(--text-soft); font-size: 12px; font-weight: 500; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background 0.15s; }
.avatar:hover { background: var(--warm-2); }

/* ‚îÄ‚îÄ PANELS WRAPPER ‚îÄ‚îÄ */
.panels { display: flex; flex: 1; overflow: hidden; }

/* ‚îÄ‚îÄ LEFT PANEL ‚îÄ‚îÄ */
.left-panel {
  width: 420px; flex-shrink: 0;
  background: var(--surface);
  border-right: 1px solid var(--warm-1);
  display: flex; flex-direction: column;
  padding: 36px 42px 36px;
  overflow-y: auto; position: relative;
}

/* Step dots */
.step-dots { display: flex; gap: 6px; margin-bottom: 40px; }
.sdot { height: 3px; border-radius: 2px; background: var(--warm-2); transition: all 0.3s var(--ease); }
.sdot.done   { background: var(--warm-3); width: 14px; }
.sdot.active { background: var(--sage);   width: 28px; }
.sdot.future { background: var(--warm-1); width: 14px; }

/* Steps */
.step { display: none; animation: fadeUp 0.28s ease both; }
.step.show { display: flex; flex-direction: column; flex: 1; }
@keyframes fadeUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

.step-eyebrow { font-size: 10px; text-transform: uppercase; letter-spacing: 0.13em; color: var(--text-muted); margin-bottom: 10px; }
.step-title { font-family: 'Cormorant Garamond', serif; font-size: 28px; font-weight: 400; line-height: 1.25; margin-bottom: 10px; }
.step-title em { font-style: italic; color: var(--text-soft); }
.step-desc { font-size: 13px; color: var(--text-soft); line-height: 1.75; margin-bottom: 22px; }

/* Input */
.field {
  width: 100%; padding: 11px 14px;
  border: 1px solid var(--warm-2); border-radius: 11px;
  background: var(--bg); font-family: 'DM Sans', sans-serif;
  font-size: 13px; color: var(--text); outline: none;
  transition: border-color 0.2s; margin-bottom: 10px;
}
.field:focus { border-color: var(--sage); }

/* Tip card */
.tip-card {
  background: rgba(143,166,140,0.08); border: 1px solid rgba(143,166,140,0.2);
  border-radius: 11px; padding: 13px 15px; margin-bottom: 16px; position: relative;
}
.tip-card-inner { display: flex; gap: 10px; align-items: flex-start; }
.tip-icon { font-size: 14px; flex-shrink: 0; margin-top: 1px; }
.tip-text { font-size: 12px; color: var(--text-soft); line-height: 1.7; }
.tip-text strong { color: var(--text); font-weight: 500; }
.tip-dismiss { position: absolute; top: 8px; right: 10px; font-size: 14px; color: var(--text-muted); cursor: pointer; opacity: 0.5; transition: opacity 0.15s; }
.tip-dismiss:hover { opacity: 1; }

/* Four laws mini */
.laws-mini { display: flex; gap: 6px; margin-bottom: 18px; flex-wrap: wrap; }
.law-mini-pill {
  padding: 3px 10px; border-radius: 100px; font-size: 10.5px;
  border: 1px solid var(--warm-2); color: var(--text-muted); transition: all 0.2s; cursor: pointer;
}
.law-mini-pill.lit-amber { background: rgba(196,136,122,0.12); color: var(--amber); border-color: rgba(196,136,122,0.3); }

/* Law badge */
.law-badge { display: inline-flex; align-items: center; gap: 5px; padding: 3px 10px; border-radius: 100px; font-size: 10.5px; margin-bottom: 14px; font-weight: 500; letter-spacing: 0.03em; }
.law-easy       { background: rgba(143,166,140,0.12); color: var(--sage); }
.law-satisfying { background: rgba(123,155,175,0.12); color: var(--blue); }

/* Expandable hint */
.hint-toggle { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-muted); cursor: pointer; margin-bottom: 14px; width: fit-content; transition: color 0.15s; }
.hint-toggle:hover { color: var(--text-soft); }
.hint-toggle-icon { transition: transform 0.2s; font-size: 10px; }
.hint-toggle.open .hint-toggle-icon { transform: rotate(90deg); }
.hint-body { background: var(--warm-1); border-radius: 10px; padding: 13px 15px; font-size: 12px; color: var(--text-soft); line-height: 1.75; margin-bottom: 14px; display: none; }
.hint-body.show { display: block; animation: fadeUp 0.2s ease; }
.hint-body p { margin-bottom: 8px; }
.hint-body p:last-child { margin-bottom: 0; }

/* Stepper */
.stepper { display: flex; align-items: center; gap: 18px; margin-bottom: 8px; }
.step-btn { width: 36px; height: 36px; border-radius: 50%; background: var(--warm-1); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; color: var(--text-soft); transition: all 0.15s; user-select: none; }
.step-btn:hover { background: var(--warm-2); }
.step-num-wrap { text-align: center; }
.step-num { font-family: 'Cormorant Garamond', serif; font-size: 44px; font-weight: 300; line-height: 1; color: var(--text); }
.step-unit { font-size: 11px; color: var(--text-muted); }
.freq-note { font-size: 12px; color: var(--text-muted); margin-bottom: 18px; font-style: italic; padding-left: 4px; }

/* System/Goal */
.sys-goal-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 24px; }
.sg-card { border-radius: 13px; padding: 16px; cursor: pointer; border: 2px solid var(--warm-1); background: var(--bg); transition: all 0.2s; }
.sg-card:hover { border-color: var(--warm-2); }
.sg-card.on { border-color: var(--text); background: var(--surface); }
.sg-icon { font-size: 20px; margin-bottom: 8px; }
.sg-label { font-family: 'Cormorant Garamond', serif; font-size: 17px; font-weight: 400; margin-bottom: 4px; }
.sg-desc { font-size: 11px; color: var(--text-muted); line-height: 1.6; }

/* Quote */
.quote-block { border-left: 3px solid var(--warm-2); padding: 12px 16px; margin-bottom: 20px; background: rgba(237,233,227,0.4); border-radius: 0 10px 10px 0; }
.quote-text { font-family: 'Cormorant Garamond', serif; font-size: 16px; font-style: italic; font-weight: 300; line-height: 1.7; color: var(--text-soft); margin-bottom: 5px; }
.quote-attr { font-size: 10.5px; color: var(--text-muted); letter-spacing: 0.05em; }

/* Timeframe */
.timeframe-options { display: flex; flex-direction: column; gap: 7px; margin-bottom: 18px; }
.tf-option { display: flex; align-items: center; gap: 12px; padding: 11px 14px; border-radius: 11px; border: 1.5px solid var(--warm-1); background: var(--bg); cursor: pointer; transition: all 0.18s; }
.tf-option:hover { border-color: var(--warm-2); }
.tf-option.on { border-color: var(--text); background: var(--surface); }
.tf-radio { width: 16px; height: 16px; border-radius: 50%; border: 1.5px solid var(--warm-2); flex-shrink: 0; display: flex; align-items: center; justify-content: center; transition: all 0.18s; }
.tf-option.on .tf-radio { border-color: var(--text); background: var(--text); }
.tf-option.on .tf-radio::after { content: ''; width: 6px; height: 6px; border-radius: 50%; background: white; }
.tf-label { font-size: 13px; color: var(--text-soft); flex: 1; }
.tf-option.on .tf-label { color: var(--text); font-weight: 500; }
.tf-range { font-size: 10.5px; color: var(--text-muted); white-space: nowrap; }

/* Date fields */
.date-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px; }
.date-field-wrap { display: flex; flex-direction: column; gap: 5px; }
.date-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.08em; }
.field-date { width: 100%; padding: 10px 13px; border: 1px solid var(--warm-2); border-radius: 11px; background: var(--bg); font-family: 'DM Sans', sans-serif; font-size: 13px; color: var(--text); outline: none; transition: border-color 0.2s; }
.field-date:focus { border-color: var(--sage); }

/* Nav buttons */
.step-nav { margin-top: auto; padding-top: 24px; display: flex; gap: 10px; align-items: center; }
.btn-next { flex: 1; padding: 13px; background: var(--text); color: var(--bg); border: none; border-radius: 11px; font-family: 'DM Sans', sans-serif; font-size: 13px; letter-spacing: 0.04em; cursor: pointer; transition: all 0.18s; }
.btn-next:hover { background: #1a1714; }
.btn-back { padding: 13px 18px; background: transparent; border: 1px solid var(--warm-2); border-radius: 11px; font-family: 'DM Sans', sans-serif; font-size: 13px; color: var(--text-soft); cursor: pointer; transition: all 0.18s; }
.btn-back:hover { background: var(--warm-1); }

/* ‚îÄ‚îÄ RIGHT PANEL ‚îÄ‚îÄ */
.right-panel { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; position: relative; overflow: hidden; }
.preview-label { position: absolute; top: 28px; left: 0; right: 0; text-align: center; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; }

.mandala-preview { display: flex; flex-direction: column; align-items: center; gap: 0; }

.preview-header { display: flex; flex-direction: column; align-items: center; gap: 3px; margin-bottom: 16px; text-align: center; }
.preview-habit-name { font-family: 'Cormorant Garamond', serif; font-size: 19px; font-style: italic; font-weight: 300; color: var(--text-soft); letter-spacing: 0.04em; min-height: 28px; }

.preview-meta { display: flex; align-items: center; gap: 8px; margin-top: 14px; font-size: 11px; color: var(--text-muted); flex-wrap: wrap; justify-content: center; }
.preview-meta-sep { color: var(--warm-2); }
.preview-meta-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--sage); flex-shrink: 0; }

.empty-mandala-msg { font-size:12px; color:var(--text-muted); font-style:italic; font-family:'Cormorant Garamond',serif; margin-top:10px; text-align:center; }

/* Chip hint */
.hint-body.show { display: block; }

::-webkit-scrollbar { width:4px; }
::-webkit-scrollbar-thumb { background:var(--warm-2); border-radius:2px; }
</style>
</head>
<body>

<div class="topbar">
  <a href="../index.html" class="logo-zone">
    <span class="logo">ñ¢ª</span><span class="logo-name">PetalProgress</span>
  </a>
  <div class="nav-tabs">
    <div class="nav-tab active">Mandala</div>
    <div class="nav-tab disabled">Gallery</div>
    <div class="nav-tab disabled">All Calendars</div>
  </div>
  <div class="topbar-right">
    <span class="mandala-name-tag" id="navHabitName"></span>
    <div class="avatar">C</div>
  </div>
</div>

<div class="panels">

<!-- ‚îÄ‚îÄ LEFT PANEL ‚îÄ‚îÄ -->
<div class="left-panel">
  <div class="step-dots" id="stepDots"></div>

  <!-- STEP 0: Welcome -->
  <div class="step show" id="step-0">
    <div class="step-eyebrow">Welcome</div>
    <div class="step-title">Let's build something <em>lasting.</em></div>
    <div class="step-desc">PetalProgress isn't about hitting targets. It's about falling in love with the process of showing up ‚Äî and watching that process bloom over time.</div>
    <div class="quote-block">
      <div class="quote-text">"You do not rise to the level of your goals. You fall to the level of your systems."</div>
      <div class="quote-attr">‚Äî James Clear, Atomic Habits</div>
    </div>
    <div class="step-desc" style="margin-bottom:0">We'll help you set up a habit, give it a home in your mandala, and build a rhythm that actually sticks. It takes about 3 minutes.</div>
    <div class="step-nav">
      <button class="btn-next" onclick="goStep(1)">Get started ‚Üí</button>
    </div>
  </div>

  <!-- STEP 1: System vs Goal -->
  <div class="step" id="step-1">
    <div class="step-eyebrow">Step 1 of 5 ¬∑ Foundation</div>
    <div class="step-title">Set a <em>system,</em> not just a goal.</div>
    <div class="step-desc">Goals are outcomes. Systems are the habits that get you there. In PetalProgress, your mandala <em>is</em> your system ‚Äî each petal is a day you showed up.</div>
    <div class="sys-goal-row">
      <div class="sg-card" onclick="selSG(this)">
        <div class="sg-icon">üèÜ</div>
        <div class="sg-label">Goal</div>
        <div class="sg-desc">A destination to reach. Useful for direction, but fragile ‚Äî it ends when you arrive.</div>
      </div>
      <div class="sg-card on" onclick="selSG(this)">
        <div class="sg-icon">üåÄ</div>
        <div class="sg-label">System</div>
        <div class="sg-desc">A process you return to, again and again. Your mandala grows from this ‚Äî there's no finish line.</div>
      </div>
    </div>
    <div class="tip-card">
      <div class="tip-card-inner">
        <div class="tip-icon">üí°</div>
        <div class="tip-text">You can still have goals ‚Äî just don't let them be the only thing. A goal gives you direction. Your system gives you progress, even on hard days.</div>
      </div>
      <div class="tip-dismiss" onclick="this.closest('.tip-card').style.display='none'">√ó</div>
    </div>
    <div class="step-nav">
      <button class="btn-back" onclick="goStep(0)">Back</button>
      <button class="btn-next" onclick="goStep(2)">Continue ‚Üí</button>
    </div>
  </div>

  <!-- STEP 2: Define Habit -->
  <div class="step" id="step-2">
    <div class="step-eyebrow">Step 2 of 5 ¬∑ Your Habit</div>
    <div class="step-title">What will you <em>practice?</em></div>
    <div class="step-desc">Name your habit. The clearer the description, the easier it is to follow through.</div>
    <div class="laws-mini">
      <div class="law-mini-pill" onclick="selChip(1,this)">‚ë† Obvious</div>
      <div class="law-mini-pill" onclick="selChip(2,this)">‚ë° Easy</div>
      <div class="law-mini-pill" onclick="selChip(3,this)">‚ë¢ Attractive</div>
      <div class="law-mini-pill" onclick="selChip(4,this)">‚ë£ Satisfying</div>
    </div>
    <div class="hint-body" id="chipDesc" style="margin-bottom:14px;"></div>
    <input class="field" id="habitInput" type="text"
      placeholder="e.g. 10 minutes of meditation after morning coffee"
      oninput="updatePreview()">
    <div class="hint-toggle" onclick="toggleHint('habitHint',this)">
      <span class="hint-toggle-icon">‚ñ∂</span> What makes a good habit name?
    </div>
    <div class="hint-body" id="habitHint">
      <p>A habit name that includes a little context ‚Äî like a time of day or a place ‚Äî can make it much easier to follow through. Even something simple like "after breakfast" or "before bed" gives your brain a friendly nudge.</p>
      <p>That said, there's no wrong way to name it. Start wherever feels natural to you.</p>
    </div>
    <div class="step-nav">
      <button class="btn-back" onclick="goStep(1)">Back</button>
      <button class="btn-next" onclick="goStep(3)">Continue ‚Üí</button>
    </div>
  </div>

  <!-- STEP 3: Timeframe -->
  <div class="step" id="step-3">
    <div class="step-eyebrow">Step 3 of 5 ¬∑ Your Timeframe</div>
    <div class="step-title">How long will you <em>commit?</em></div>
    <div class="step-desc">Choose the span of your mandala. This shapes how your petals are arranged and what a complete mandala looks like.</div>
    <div class="timeframe-options">
      <div class="tf-option on" onclick="selTF('yearly',this)">
        <div class="tf-radio"></div>
        <div class="tf-label">Yearly</div>
        <div class="tf-range">12 months ¬∑ 52 weeks</div>
      </div>
      <div class="tf-option" onclick="selTF('quarterly',this)">
        <div class="tf-radio"></div>
        <div class="tf-label">Quarterly</div>
        <div class="tf-range">3 months ¬∑ 13 weeks</div>
      </div>
      <div class="tf-option" onclick="selTF('monthly',this)">
        <div class="tf-radio"></div>
        <div class="tf-label">Monthly</div>
        <div class="tf-range">4 weeks ¬∑ ~30 days</div>
      </div>
      <div class="tf-option" onclick="selTF('weekly',this)">
        <div class="tf-radio"></div>
        <div class="tf-label">Weekly</div>
        <div class="tf-range">7 days</div>
      </div>
      <div class="tf-option" onclick="selTF('custom',this)">
        <div class="tf-radio"></div>
        <div class="tf-label">Custom</div>
        <div class="tf-range">You choose the dates</div>
      </div>
    </div>
    <div class="date-row">
      <div class="date-field-wrap">
        <div class="date-label">Start date</div>
        <input class="field-date" type="date" id="startDate" oninput="updatePreviewMeta()">
      </div>
      <div class="date-field-wrap" id="endDateWrap" style="display:none;">
        <div class="date-label">End date</div>
        <input class="field-date" type="date" id="endDate" oninput="updatePreviewMeta()">
      </div>
    </div>
    <div class="step-nav">
      <button class="btn-back" onclick="goStep(2)">Back</button>
      <button class="btn-next" onclick="goStep(4)">Continue ‚Üí</button>
    </div>
  </div>

  <!-- STEP 4: Weekly target -->
  <div class="step" id="step-4">
    <div class="step-eyebrow">Step 4 of 5 ¬∑ Your Rhythm</div>
    <div class="step-title">How often <em>feels right?</em></div>
    <div class="step-desc">Set a weekly target that feels achievable ‚Äî not aspirational. You can always adjust it later.</div>
    <div class="law-badge law-easy">‚ë° Make it Easy</div>
    <div class="stepper">
      <div class="step-btn" onclick="stepGoal(-1)">‚àí</div>
      <div class="step-num-wrap">
        <div class="step-num" id="goalNum">3</div>
        <div class="step-unit">√ó per week</div>
      </div>
      <div class="step-btn" onclick="stepGoal(1)">+</div>
    </div>
    <div class="freq-note" id="freqNote">A gentle start. Consistency matters more than intensity.</div>
    <div class="tip-card">
      <div class="tip-card-inner">
        <div class="tip-icon">üå±</div>
        <div class="tip-text"><strong>Start smaller than you think.</strong> A weekly target you hit reliably beats an ambitious one you skip. You can always raise it once the habit sticks.</div>
      </div>
      <div class="tip-dismiss" onclick="this.closest('.tip-card').style.display='none'">√ó</div>
    </div>
    <div class="hint-toggle" onclick="toggleHint('goalHint',this)">
      <span class="hint-toggle-icon">‚ñ∂</span> The two-minute rule
    </div>
    <div class="hint-body" id="goalHint">
      <p>When starting a new habit, scale it down until it takes two minutes or less. "Read every night" becomes "Read one page." "Run 5 miles" becomes "Put on running shoes."</p>
      <p>The point isn't the two minutes ‚Äî it's showing up. Once you're there, you'll usually keep going.</p>
    </div>
    <div class="step-nav">
      <button class="btn-back" onclick="goStep(3)">Back</button>
      <button class="btn-next" onclick="goStep(6)">Continue ‚Üí</button>
    </div>
  </div>

  <!-- STEP 6: Reveal -->
  <div class="step" id="step-6">
    <div class="step-eyebrow">You're all set</div>
    <div class="step-title"><em>Congratulations</em> on starting your system.</div>
    <div class="step-desc">Your mandala is ready. Every time you check in, your mandala is richer. The pattern that emerges over time is yours alone ‚Äî a record of every day you showed up.</div>
    <div class="quote-block">
      <div class="quote-text">"Every action you take is a vote for the type of person you wish to become."</div>
      <div class="quote-attr">‚Äî James Clear, Atomic Habits</div>
    </div>
    <div class="step-nav">
      <button class="btn-back" onclick="goStep(4)">Back</button>
      <button class="btn-next" onclick="finish()" style="background:var(--sage)">Open my mandala ‚Üí</button>
    </div>
  </div>

</div><!-- end left panel -->

<!-- ‚îÄ‚îÄ RIGHT PANEL ‚îÄ‚îÄ -->
<div class="right-panel">
  <div class="mandala-preview">
    <svg id="previewSVG" width="300" height="300" viewBox="0 0 320 320"
      style="filter:drop-shadow(0 16px 48px rgba(0,0,0,0.07));transition:all 0.5s">
      <circle cx="160" cy="160" r="154" fill="#FDFCFA" stroke="#EDE9E3" stroke-width="1"/>
      <circle cx="160" cy="160" r="142" stroke="#D4CEC7" stroke-width="0.5" stroke-dasharray="3 4" opacity="0.4"/>
      <g id="ring4"></g>
      <g id="ring3"></g>
      <g id="ring2"></g>
      <g id="ring1"></g>
      <circle cx="160" cy="160" r="26" fill="none" stroke="#EDE9E3" stroke-width="1.5"/>
      <circle cx="160" cy="160" r="18" fill="#F8F6F3" stroke="#D4CEC7" stroke-width="1"/>
      <text x="160" y="167" text-anchor="middle" font-size="18" id="centerFig">üå∏</text>
    </svg>
  </div>
</div>

</div><!-- end panels -->

<script>
const TOTAL = 6;
let currentStep = 0;
let goalN = 3;
let petalColor = '#7B9BAF';
let petalShape = 'oval';
let selectedTF = 'yearly';

const CHIP_DESC = {
  1: 'Make your habit visible and clear. A cue ‚Äî a time of day, a place, or a small trigger ‚Äî helps your brain know exactly when to act.',
  2: 'Lower the barrier to start. The easier a habit is to begin, the more likely you are to do it, especially on harder days.',
  3: 'Connect your habit to something you enjoy or look forward to. The more appealing it feels, the more you\'ll want to return.',
  4: 'Give yourself a small sense of completion after each check-in. That feeling of progress is what keeps you coming back.',
};

function selChip(n, el) {
  const pills = document.querySelectorAll('.law-mini-pill');
  const desc = document.getElementById('chipDesc');
  const already = el.classList.contains('lit-amber');
  pills.forEach(p => p.className = 'law-mini-pill');
  if (already) { desc.style.display = 'none'; }
  else { el.classList.add('lit-amber'); desc.textContent = CHIP_DESC[n]; desc.style.display = 'block'; }
}

const TF_LABELS = { yearly:'Yearly mandala', quarterly:'Quarterly mandala', monthly:'Monthly mandala', weekly:'Weekly mandala', custom:'Custom mandala' };

function buildDots() {
  const wrap = document.getElementById('stepDots');
  const vis = TOTAL - 1;
  const cur = Math.max(0, currentStep - 1);
  wrap.innerHTML = Array.from({length:vis}, (_,i) => {
    const cls = i < cur ? 'done' : i === cur ? 'active' : 'future';
    return `<div class="sdot ${cls}"></div>`;
  }).join('');
}

function goStep(n) {
  document.getElementById('step-'+currentStep).classList.remove('show');
  currentStep = n;
  document.getElementById('step-'+n).classList.add('show');
  buildDots(); updateMandala();
}

function selSG(el) {
  document.querySelectorAll('.sg-card').forEach(c=>c.classList.remove('on'));
  el.classList.add('on');
}

function updatePreview() {
  const val = document.getElementById('habitInput').value.trim();
  document.getElementById('previewTitleText').textContent = val || 'My practice';
  document.getElementById('navHabitName').textContent = val || '';
}

function selTF(type, el) {
  selectedTF = type;
  document.querySelectorAll('.tf-option').forEach(o=>o.classList.remove('on'));
  el.classList.add('on');
  document.getElementById('endDateWrap').style.display = type === 'custom' ? '' : 'none';
  if (!document.getElementById('startDate').value) {
    document.getElementById('startDate').value = new Date().toISOString().split('T')[0];
  }
  updatePreviewMeta();
}

function updatePreviewMeta() {
  const startVal = document.getElementById('startDate').value;
  const endVal = document.getElementById('endDate').value;
  document.getElementById('metaTimeframe').textContent = TF_LABELS[selectedTF];
  if (startVal) {
    const d = new Date(startVal + 'T00:00:00');
    const fmt = d.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});
    let str = 'Starts ' + fmt;
    if (selectedTF === 'custom' && endVal) {
      const d2 = new Date(endVal + 'T00:00:00');
      str += ' ‚Üí ' + d2.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});
    }
    document.getElementById('metaStart').textContent = str;
  } else {
    document.getElementById('metaStart').textContent = 'Set a start date';
  }
}

const FREQ_NOTES = {
  1:'A single commitment. Small and sturdy.',
  2:'Gentle and sustainable.',
  3:'A gentle start. Consistency matters more than intensity.',
  4:'A solid rhythm ‚Äî four days leaves room for life.',
  5:'Five days is strong. Leave yourself a rest day.',
  6:'Ambitious. Make sure each session is short enough to sustain.',
  7:'Every day. Consider making each session very brief.',
};
function stepGoal(d) {
  goalN = Math.min(7, Math.max(1, goalN + d));
  document.getElementById('goalNum').textContent = goalN;
  document.getElementById('freqNote').textContent = FREQ_NOTES[goalN];
  updateMandala();
}

function toggleHint(id, btn) {
  const body = document.getElementById(id);
  const open = body.classList.contains('show');
  body.classList.toggle('show', !open);
  btn.classList.toggle('open', !open);
}

function makePetal(x, y, rx, ry, angle, color, opacity) {
  const t = `rotate(${angle.toFixed(1)} ${x.toFixed(1)} ${y.toFixed(1)})`;
  return `<ellipse cx="${x.toFixed(1)}" cy="${y.toFixed(1)}" rx="${rx}" ry="${ry}" fill="${color}" opacity="${opacity}" transform="${t}"/>`;
}

function buildRing(gId, n, r, rx, ry, filledN, cx, cy) {
  const g = document.getElementById(gId);
  if (!g) return;
  let h = '';
  for (let i=0; i<n; i++) {
    const angle = i * (360/n);
    const a = angle * Math.PI/180;
    const x = cx + r*Math.cos(a);
    const y = cy + r*Math.sin(a);
    const filled = filledN === undefined || i < filledN;
    h += makePetal(x, y, rx, ry, angle, filled ? petalColor : '#EDE9E3', filled ? 0.9 : 0.5);
  }
  g.innerHTML = h;
}

function updateMandala() {
  const s = currentStep;
  const cx = 160, cy = 160;
  ['ring1','ring2','ring3','ring4'].forEach(id => { const g=document.getElementById(id); if(g) g.innerHTML=''; });
  const msg = document.getElementById('emptyMsg');
  msg.style.opacity = s >= 6 ? '1' : s <= 1 ? '1' : '0.4';
  if (s >= 2) buildRing('ring1', 8,  40, 5,   12, undefined, cx, cy);
  if (s >= 4) buildRing('ring2', 12, 66, 5.5, 13, Math.round((goalN/7)*12), cx, cy);
  if (s >= 5) buildRing('ring3', 16, 94, 6,   14, 6, cx, cy);
  if (s >= 6) { buildRing('ring4', 20, 122, 5, 13, 0, cx, cy); msg.textContent = 'Check in tomorrow to bloom your first petal.'; }
}

function finish() {
  window.location.href = './mandala.html';
}

document.getElementById('startDate').value = new Date().toISOString().split('T')[0];
updatePreviewMeta();
buildDots();
updateMandala();
</script>
</body>
</html>
